<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pay to Download PDF</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/favicon/favicon.png">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 15px;
      /* mobile spacing */
    }

    /* Alert Message Box Styles */
    #alert-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #f9edbe;
      border: 1px solid #f0c36d;
      width: 300px;
      height: 300px;
      padding: 20px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      animation: fadeIn 0.5s ease-in-out;
    }

    #alert-box .alert-content p {
      margin: 0;
      font-size: 1rem;
      color: #333;
    }

    #alert-box #alert-close-btn {
      background-color: #f0c36d;
      border: none;
      margin-top: 10px;
      padding: 15px 20px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 1rem;
    }

    #alert-box #alert-close-btn:hover {
      background-color: #e6b24c;
    }

    /* FORM STYLES */
    form {
      background: transparent;
      /* remove white box */
      padding: 0;
      border-radius: 0;
      max-width: 100%;
      margin: 0 auto;
      box-sizing: border-box;
      box-shadow: none;
    }

    form label {
      margin-top: 14px;
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    form input,
    form select,
    form button {
      width: 100%;
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    select {
      background-color: #fff;
      cursor: pointer;
    }

    small {
      font-size: 12px;
      color: #666;
    }

    button {
      background: #E64A19;
      color: white;
      border: none;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }

    button:hover {
      background: #FF5F1F;
    }

    /* PAYMENT BOX STYLES */
    .payment-box,
    form {
      width: 100%;
      max-width: 520px;
      /* desktop width */
    }

    .payment-box {
      width: 100%;
      max-width: 520px;
      /* desktop width */
      margin: 30px auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      text-align: center;
    }


    .payment-box h1 {
      margin-bottom: 10px;
      color: #222;
    }

    .payment-box p {
      color: #555;
      font-size: 14px;
    }

    .qr {
      width: 220px;
      margin: 20px auto;
      border-radius: 10px;
      border: 1px solid #ddd;
    }

    /* PRICE DETAILS */
    .price-card {
      background: linear-gradient(135deg, #eef6ff, #ffffff);
      border: 1px solid #d6e8ff;
      border-radius: 14px;
      padding: 18px 15px;
      margin: 20px 0;
      text-align: center;
    }

    .price {
      font-size: 34px;
      font-weight: bold;
      color: #0d6efd;
      margin-bottom: 4px;
    }

    .price-note {
      font-size: 13px;
      color: #444;
      margin-top: 4px;
    }

    .important {
      margin-top: 15px;
      font-weight: bold;
      color: green
    }

    .note {
      font-size: 13px;
      color: #555;
      margin-top: 6px;
      text-align: left;
      color: green;
    }

    /* RESPONSIVE STYLES */
    @media (max-width: 480px) {
      .payment-box {
        padding: 18px;
      }

      form {
        padding: 0;
      }

      .price {
        font-size: 24px;
      }

      button {
        font-size: 16px;
      }
    }
  </style>
</head>

<body>
  <!-- Alert Message Box -->
  <section id="alert-box" style="display: flex;">
    <div class="alert-content">
      <p>
        üéÅ <strong>Free Access Available!</strong><br>
        Get free access to the <strong>PDF of Important Questions</strong> while our payment system is being set
        up.<br><br>

        üìù <strong>How to get access:</strong><br>
        ‚Ä¢ Fill the form below<br>
        ‚Ä¢ Select <strong>‚Çπ99</strong> as the payment amount<br>
        ‚Ä¢ Enter <strong>any UTR number</strong> (for now)<br><br>

        ‚è≥ This free access is temporary and will be disabled once the payment system goes live.
      </p>


      <button id="alert-close-btn">Close</button>
    </div>
  </section>

  <!-- PAYMENT SECTION -->
  <section class="payment-box">
    <h1>Pay to Download PDF</h1>
    <p>Scan the QR code using any UPI app and complete the payment.</p>

    <img src="images/your-upi-qr.png" alt="UPI QR Code" class="qr">

    <!-- PRICE DETAILS -->

    <section class="price-card">
      <div class="price">‚Çπ99</div>
      <div class="price-note"><strong>Per Subject</strong></div>
      <div class="price-note">‚úî Separate payment for each subject</div>
      <div class="price-note">‚è≥ 3 months view-only access</div>
      <div class="price-note">üö´ Print & download disabled</div>
      <div class="important">Important:</div>
      <div class="note">
        ‚úî After payment, fill in the form below with accurate details including UTR.<br>
        ‚úî You will receive the PDF link via email after verification (may take up to 24 hours).<br>
      </div>
    </section>

    <!-- PAYMENT DETAILS FORM -->

    <form id="myForm" method="POST" enctype="multipart/form-data">

      <!-- FormSubmit settings -->
      <input type="hidden" name="_subject" value="PDF Payment Verification">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_template" value="table">

      <label>Your Name</label>
      <input type="text" name="name" placeholder="Enter your name" required>

      <label>Email Address</label>
      <input type="email" id="email" name="email" placeholder="example@gmail.com" required>

      <label>Select Class</label>
      <select name="class" id="classSelect" required>
        <option value="">Select Your Class</option>
      </select>

      <label>Select Subject</label>
      <select name="subject" id="subjectSelect" required disabled>
        <option value="">Select Subject</option>
      </select>

      <label>Select Chapter</label>
      <select name="chapter" id="chapterSelect" required disabled>
        <option value="">Select Chapter</option>
      </select>

      <!-- ‚úÖ Amount Paid BEFORE UTR -->
      <label>Amount Paid (‚Çπ)</label>
      <select name="amount_paid" id="amountSelect" required>
        <option value="">Select Amount</option>
        <option value="‚Çπ99">‚Çπ99</option>
        <option value="‚Çπ199">‚Çπ199</option>
      </select>
      <small>Enter the exact amount you paid</small>

      <label>UPI Transaction ID (UTR)</label>
      <input type="text" name="utr" placeholder="Example: 325487XXXX" required pattern="[A-Za-z0-9]{8,20}">
      <small>UTR is available in your payment app</small>

      <label>Payment Screenshot (Optional)</label>
      <input type="file" name="screenshot" accept=".jpg,.jpeg,.png">
      <small>Upload only if available. Max size: 5 MB</small>

      <button type="submit">Submit Payment Details</button>

    </form>
  </section>

  <!-- JavaScript + Google Apps Script Link Form Submission -->
  <script>
    
    const scriptURL =
      'https://script.google.com/macros/s/AKfycbxT7q-kz95bnMY24tBcyRTBLrYXDOODtcbvacnG6xBdxwIYKPraC4gw9JMoL9Fe1bLWfw/exec';

    const form = document.getElementById('myForm');

    form.addEventListener('submit', e => {
      e.preventDefault();
      const button = form.querySelector('button');
      button.disabled = true;
      button.textContent = 'Submitting...';

      const fileInput = form.querySelector('input[name="screenshot"]');
      const file = fileInput.files[0];

      const MAX_SIZE = 5 * 1024 * 1024; // 5 MB

      // ‚ùå File too large2
      if (file && file.size > MAX_SIZE) {
        alert("‚ùå Screenshot size must not exceed 5 MB.");
        button.disabled = false;
        button.textContent = 'Submit Payment Details';
        return;
      }

      // ‚úÖ If file exists and size is OK
      if (file) {
        const reader = new FileReader();
        reader.onload = function () {
          const base64Data = reader.result.split(',')[1];
          sendData(base64Data, file.name, file.type);
        };
        reader.readAsDataURL(file);
      }
      // ‚úÖ If no file uploaded
      else {
        sendData(null, null, null);
      }
    });

    function sendData(base64, fileName, mimeType) {
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      // Add file data to the object
      data.fileData = base64;
      data.fileName = fileName;
      data.mimeType = mimeType;
      data.token = 'neoaspire_form_v1_9F3kL2@2026'; // Add a token for basic verification

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify(data) // Send as JSON string
      })

        .then(res => res.json())
        .then(response => {
          if (response.status === 'success') {
            alert(
              'Success! Data submitted.\n' +
              'You will receive the PDF link via email after verification.'
            );

            // Redirect AFTER user clicks OK
            form.reset();
            window.location.href = "../qbank.html";

          }
          else {
            alert('Error: ' + response.message);
          }
        })

        .catch(error => console.error('Error!', error.message))
        .finally(() => {
          const button = form.querySelector('button');
          button.disabled = false;
          button.textContent = 'Submit Payment Details';
        });
    }
  </script>

  <!-- DEPENDENT DROPDOWNS SCRIPT -->
  <script>
    (async function loadDropdowns() {
      const paths = [
        './payments-dropdowns.json',
        '../payments/payments-dropdowns.json',
        '/payments/payments-dropdowns.json'
      ];

      let dataMap = null;
      for (const p of paths) {
        try {
          const res = await fetch(p);
          if (res && res.ok) {
            dataMap = await res.json();
            break;
          }
        } catch (e) {
          // try next path
        }
      }

      if (!dataMap) {
        console.warn('payments-dropdowns.json not found; using fallback dataMap');
        dataMap = {
          "Class 9": { "Maths": ["All Chapters"], "Science": ["All Chapters"] },
          "Class 10": { "Maths": ["All Chapters"], "Science": ["All Chapters"] }
        };
      }

      const classSelect = document.getElementById("classSelect");
      const subjectSelect = document.getElementById("subjectSelect");
      const chapterSelect = document.getElementById("chapterSelect");

      // Populate class options from JSON keys
      classSelect.innerHTML = '<option value="">Select Your Class</option>';
      Object.keys(dataMap).forEach(cls => classSelect.add(new Option(cls, cls)));

      // Reset subject/chapter
      subjectSelect.innerHTML = '<option value="">Select Subject</option>';
      subjectSelect.disabled = true;
      chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
      chapterSelect.disabled = true;

      classSelect.addEventListener("change", () => {
        subjectSelect.innerHTML = '<option value="">Select Subject</option>';
        chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
        subjectSelect.disabled = true;
        chapterSelect.disabled = true;

        const selectedClass = classSelect.value;
        if (!selectedClass || !dataMap[selectedClass]) return;

        subjectSelect.disabled = false;
        Object.keys(dataMap[selectedClass]).forEach(subject => {
          subjectSelect.add(new Option(subject, subject));
        });
      });

      subjectSelect.addEventListener("change", () => {
        chapterSelect.innerHTML = '<option value="">Select Chapter</option>';
        chapterSelect.disabled = true;

        const selectedClass = classSelect.value;
        const selectedSubject = subjectSelect.value;
        if (!selectedClass || !selectedSubject) return;

        const chapters = dataMap[selectedClass][selectedSubject] || [];
        chapters.forEach(ch => chapterSelect.add(new Option(ch, ch)));
        chapterSelect.disabled = chapters.length === 0;
      });
    })();
  </script>

  <!-- EMAIL VALIDATION SCRIPT -->
  <script>
    const emailInput = document.getElementById("email");

    emailInput.addEventListener("input", () => {
      const email = emailInput.value.trim().toLowerCase();

      if (email && !email.endsWith("@gmail.com")) {
        emailInput.setCustomValidity("Only Gmail addresses (@gmail.com) are allowed");
      } else {
        emailInput.setCustomValidity("");
      }
    });
  </script>

  <!-- ALERT BOX SCRIPT -->
  <script>
    window.addEventListener("load", function () {
      const alertBox = document.getElementById("alert-box");
      const closeBtn = document.getElementById("alert-close-btn");
      closeBtn.addEventListener("click", function () {
        alertBox.style.display = "none";
      });
    });
  </script>

</body>

</html>